@model PBLC.Web.Models.ProfileViewModel
@{
    ViewData["Title"] = "My Profile";
}

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <h2 class="mb-4"><i class="bi bi-person-circle"></i> My Profile</h2>
        </div>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-triangle"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <div class="row">
        <!-- Profile Information Card -->
        <div class="col-md-4">
            <div class="card shadow-sm mb-4">
                <div class="card-body text-center">
                    <!-- Profile Avatar -->
                    <div class="mb-3">
                        <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center"
                             style="width: 120px; height: 120px; font-size: 3rem;">
                            <i class="bi bi-person-fill"></i>
                        </div>
                    </div>
                    
                    <!-- User Info -->
                    <h4 class="mb-1">@Model.FullName</h4>
                    <p class="text-muted mb-2">@Model.Email</p>
                    
                    <!-- Role Badge -->
                    @if (Model.Role == PBLC.Web.Models.Enums.UserRole.Admin)
                    {
                        <span class="badge bg-danger mb-3" style="font-size: 0.9rem;">
                            <i class="bi bi-shield-fill"></i> Administrator
                        </span>
                    }
                    else if (Model.Role == PBLC.Web.Models.Enums.UserRole.Teacher)
                    {
                        <span class="badge bg-primary mb-3" style="font-size: 0.9rem;">
                            <i class="bi bi-mortarboard-fill"></i> Teacher
                        </span>
                    }
                    else
                    {
                        <span class="badge bg-info mb-3" style="font-size: 0.9rem;">
                            <i class="bi bi-person-badge-fill"></i> Student
                        </span>
                    }

                    <hr>

                    <!-- Additional Info -->
                    <div class="text-start">
                        <p class="mb-2">
                            <i class="bi bi-building text-primary"></i> 
                            <strong>Faculty:</strong> @Model.FacultyName
                        </p>
                        <p class="mb-2">
                            <i class="bi bi-calendar text-success"></i> 
                            <strong>Joined:</strong> @Model.JoinedDate.ToString("MMM dd, yyyy")
                        </p>
                        <p class="mb-0">
                            <i class="bi bi-@(Model.IsActive ? "check-circle text-success" : "x-circle text-danger")"></i> 
                            <strong>Status:</strong> @(Model.IsActive ? "Active" : "Inactive")
                        </p>
                    </div>
                </div>
            </div>

            <!-- Statistics Card (Role-based) -->
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-bar-chart-fill"></i> Statistics</h5>
                </div>
                <div class="card-body">
                    @if (Model.Role == PBLC.Web.Models.Enums.UserRole.Teacher)
                    {
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-book"></i> My Courses</span>
                            <strong class="text-primary">@ViewBag.TotalCourses</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-people"></i> Total Students</span>
                            <strong class="text-success">@ViewBag.TotalStudents</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-0">
                            <span><i class="bi bi-file-earmark-text"></i> Assignments</span>
                            <strong class="text-warning">@ViewBag.TotalAssignments</strong>
                        </div>
                    }
                    else if (Model.Role == PBLC.Web.Models.Enums.UserRole.Student)
                    {
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-book"></i> Enrolled Courses</span>
                            <strong class="text-primary">@ViewBag.EnrolledCourses</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-file-earmark-check"></i> Submissions</span>
                            <strong class="text-success">@ViewBag.TotalSubmissions</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-0">
                            <span><i class="bi bi-check-circle"></i> Graded</span>
                            <strong class="text-info">@ViewBag.GradedSubmissions</strong>
                        </div>
                    }
                    else if (Model.Role == PBLC.Web.Models.Enums.UserRole.Admin)
                    {
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-people"></i> Total Users</span>
                            <strong class="text-primary">@ViewBag.TotalUsers</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-book"></i> Total Courses</span>
                            <strong class="text-success">@ViewBag.TotalCourses</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-3">
                            <span><i class="bi bi-building"></i> Departments</span>
                            <strong class="text-warning">@ViewBag.TotalDepartments</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-0">
                            <span><i class="bi bi-grid"></i> Faculties</span>
                            <strong class="text-info">@ViewBag.TotalFaculties</strong>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Edit Profile Section -->
        <div class="col-md-8">
            <!-- Edit Name Card -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="bi bi-pencil-square"></i> Edit Profile</h5>
                </div>
                <div class="card-body">
                    <form asp-action="UpdateProfile" method="post">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="fullName" class="form-label">Full Name</label>
                                    <input type="text" class="form-control" id="fullName" name="fullName" 
                                           value="@Model.FullName" required>
                                </div>
                            </div>
                            <div class="col-md-4 d-flex align-items-end">
                                <div class="mb-3 w-100">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-check-circle"></i> Update Name
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                    <div class="alert alert-info mb-0">
                        <i class="bi bi-info-circle"></i> 
                        <strong>Note:</strong> Email and Role cannot be changed. Contact administrator if needed.
                    </div>
                </div>
            </div>

            <!-- Change Password Card -->
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="bi bi-key-fill"></i> Change Password</h5>
                </div>
                <div class="card-body">
                    <form asp-action="ChangePassword" method="post">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" 
                                   name="currentPassword" required>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="newPassword" class="form-label">New Password</label>
                                    <input type="password" class="form-control" id="newPassword" 
                                           name="newPassword" minlength="6" required>
                                    <small class="text-muted">At least 6 characters</small>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="confirmPassword" class="form-label">Confirm Password</label>
                                    <input type="password" class="form-control" id="confirmPassword" 
                                           name="confirmPassword" minlength="6" required>
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-shield-lock"></i> Change Password
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .card {
        border: none;
        border-radius: 10px;
    }
    .card-header {
        border-bottom: 2px solid #f0f0f0;
    }
</style>
